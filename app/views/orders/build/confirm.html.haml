- content_for :title, 'Confirm your order'

.container
  .row
    / ==========
    / = Main content =
    / ==========
    %section.span12
      .checkout-container
        .row
          .span10.offset1
            / ==========
            / = Header =
            / ==========
            %header
              .row
                .span6.offset2
                  .center-align
                    %h1
                      %span.light Confirm
                      \& Pay
                .span2
            / ==========
            / = Steps =
            / ==========
            .checkout-steps
              .clearfix
                .step.done
                  .step-badge
                    %i.fa.fa-check
                  = link_to 'Review cart', wizard_path(:review)
                .step.done
                  .step-badge
                    %i.fa.fa-check
                  = link_to 'Billing details', wizard_path(:billing)
                .step.done
                  .step-badge
                    %i.fa.fa-check
                  = link_to 'Shipping address', wizard_path(:shipping)
                .step.done
                  .step-badge
                    %i.fa.fa-check
                  = link_to 'Payment method', wizard_path(:payment)
                .step.active
                  .step-badge 5
                  Confirm & Pay
            / /steps
            / ==========
            / = Selected Items =
            / ==========
            / %span.icon-stack
            /   %i.icon-circle-blank.icon-stack-base
            /   %i.icon-ok
            / %p
            /   You are currently logged in with the following PayPal account:
            /   %b
            /     = session["paypal_email"]
            %h5= "Payment method: PayPal"
            = form_for @order, :url => wizard_path, :html => { method: :patch, :class => 'form-horizontal form-checkout' } do |f|
              %table.table.table-items
                %thead
                  %tr
                    %th{colspan: "2"} Item
                    %th
                      .align-center Quantity
                    %th
                      .align-right Price
                    %th
                      .align-right Total
                %tbody
                  - @cart.cart_items.each do |item|
                    %tr
                      %td.image
                        = image_tag item.sku.product.attachments.first.file.square, :alt => item.sku.product.name, :height => 124, :width => 124
                      %td.desc
                        = item.sku.product.name
                        %div= sku_attribute_values(item.sku, item.sku.product.single)
                      %td.qty= item.quantity
                      %td.price= Store::Price.new(item.price).single
                      %td.price= Store::Price.new(item.total_price).single
                    - unless item.cart_item_accessory.blank?
                      %tr.accessory_row
                        %td.icon
                          %i.icon-plus
                        %td.desc
                          = item.cart_item_accessory.accessory.name
                  %tr
                    %td.image
                      = image_tag "delivery.png", :alt => @order.delivery.full_name
                    %td.desc
                      = @order.delivery.full_name
                      %div= @order.delivery_address.country
                    %td.qty
                    %td
                    %td.price= Store::Price.new(@order.delivery.price).single
                  - if Store::settings.tax_breakdown
                    %tr
                      %td.border-colspan{colspan: "3"}
                      \ 
                      %td.stronger Subtotal:
                      %td.stronger
                        .align-right= Store::Price.new(@order.net_amount).single
                    %tr
                      %td{colspan: "3", rowspan: "1"}
                      \ 
                      %td.stronger= "#{Store::settings.tax_name} (#{Store::settings.tax_rate}%):"
                      %td.stronger
                        .align-right= Store::Price.new(@order.tax_amount).single
                  %tr
                    - if Store::settings.tax_breakdown
                      %td{colspan: "3", rowspan: "2"}
                    - else
                      %td.border-colspan{colspan: "3", rowspan: "2"}
                    %td.stronger Total:
                    %td.stronger
                      .size-16.align-right.total_price= Store::Price.new(@order.gross_amount, 'net').single
              %div.right-align.terms-checkbox 
                = f.check_box :terms
                = errors_for @order, :terms
                %p 
                  Tick this box to acknowledge that you have read and agree with our 
                  = link_to 'terms and conditions', terms_path
              %p.right-align  
                = f.submit 'Confirm & pay', :class => 'btn btn-primary higher bold confirm_order'
    / /main content
/ /container
#confirmOrderModal.modal.fade{"aria-hidden" => "false", "aria-labelledby" => "confirmOrderModal", role: "dialog", tabindex: "-1", style: 'display:none;'}
  .modal-header
    %h3#confirmOrderModal
      %span.light Confirming
      Your Order
  .modal-body
    %p Please wait while we process and confirm your order.
    %div.loading-block